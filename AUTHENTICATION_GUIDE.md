# üîê 4Wheels Authentication System Guide

## Overview

The 4Wheels car rental application now has a complete user registration and login system that integrates with your Oracle database.

## Features Implemented

### 1. User Registration

- **Endpoint**: `POST /api/register`
- **Fields**:
  - First Name (required)
  - Last Name (required)
  - Email (required, validated, unique)
  - Password (required, minimum 6 characters, bcrypt hashed)
  - Phone Number (optional)
- **Database**: Inserts users into the `USERS` table
- **Security**: Passwords are hashed using bcrypt with 10 salt rounds

### 2. User Login

- **Endpoint**: `POST /api/login`
- **Fields**:
  - Email (required)
  - Password (required)
- **Validation**: Compares password against bcrypt hash
- **Response**: Returns user data (excluding password hash)
- **Session**: Stores user info in localStorage

### 3. UI Integration

- **Login Button**: Shows in navbar when user is logged out
- **User Info**: Displays user name when logged in
- **Logout Button**: Replaces login button when authenticated
- **Protected Booking**: Users must login to book cars
- **Auto-fill Forms**: Booking form pre-fills with logged-in user's data

## How to Use

### For Testing Locally:

1. **Start the server**:

   ```powershell
   npm start
   ```

2. **Open browser**:

   ```
   http://localhost:3000
   ```

3. **Create an account**:

   - Click "Login" button
   - Click "Register" link
   - Fill in your details
   - Click "Create Account"

4. **Login**:

   - Enter your email and password
   - Click "Login"

5. **Book a car**:
   - Browse available cars
   - Click "Book Now"
   - Your info will be pre-filled
   - Select dates and payment method
   - Submit booking

### For Production (GitHub Pages + Railway):

The authentication system is now live at:

- **Frontend**: https://fostersql.github.io/4Wheels/
- **Backend API**: https://4wheels-production.up.railway.app/api

## Database Schema

The system uses the existing `USERS` table in your Oracle database:

```sql
CREATE TABLE USERS (
    USER_ID        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FIRST_NAME     VARCHAR2(50) NOT NULL,
    LAST_NAME      VARCHAR2(50) NOT NULL,
    EMAIL          VARCHAR2(100) NOT NULL UNIQUE,
    PASSWORD_HASH  VARCHAR2(255) NOT NULL,
    PHONE_NUMBER   VARCHAR2(20),
    ROLE           VARCHAR2(20) DEFAULT 'customer',
    CREATED_AT     DATE DEFAULT SYSDATE
);
```

## API Endpoints

### Register New User

```http
POST /api/register
Content-Type: application/json

{
  "first_name": "John",
  "last_name": "Doe",
  "email": "john@example.com",
  "password": "securepassword",
  "phone_number": "123-456-7890"
}
```

**Response**:

```json
{
  "success": true,
  "message": "User registered successfully",
  "user": {
    "user_id": 11,
    "first_name": "John",
    "last_name": "Doe",
    "email": "john@example.com",
    "role": "customer"
  }
}
```

### Login User

```http
POST /api/login
Content-Type: application/json

{
  "email": "john@example.com",
  "password": "securepassword"
}
```

**Response**:

```json
{
  "success": true,
  "message": "Login successful",
  "user": {
    "user_id": 11,
    "first_name": "John",
    "last_name": "Doe",
    "email": "john@example.com",
    "phone_number": "123-456-7890",
    "role": "customer"
  }
}
```

## Security Features

1. **Password Hashing**: All passwords are hashed using bcrypt before storage
2. **Email Validation**: Email format is validated on both client and server
3. **Unique Emails**: Database constraint prevents duplicate email registrations
4. **Case-Insensitive Email**: Email lookup is case-insensitive
5. **Password Strength**: Minimum 6 characters required
6. **SQL Injection Protection**: Using parameterized queries with Oracle bind variables

## Session Management

- **Client-Side**: User data stored in browser's localStorage
- **Persistent**: User remains logged in across page refreshes
- **Logout**: Clears localStorage and updates UI
- **Auto-fill**: Booking form automatically populated with user data

## Files Modified

1. **server.js**: Added bcrypt import and authentication endpoints
2. **index.html**: Added registration modal HTML
3. **js/app.js**: Added authentication functions and UI updates
4. **package.json**: Added bcrypt dependency

## Testing the System

### Test Registration:

```powershell
Invoke-RestMethod -Uri "http://localhost:3000/api/register" -Method POST -Headers @{"Content-Type"="application/json"} -Body '{"first_name":"Test","last_name":"User","email":"test@example.com","password":"test123"}'
```

### Test Login:

```powershell
Invoke-RestMethod -Uri "http://localhost:3000/api/login" -Method POST -Headers @{"Content-Type"="application/json"} -Body '{"email":"test@example.com","password":"test123"}'
```

## Next Steps (Optional Enhancements)

1. **JWT Tokens**: Implement JWT for more secure session management
2. **Email Verification**: Send verification email after registration
3. **Password Reset**: Add forgot password functionality
4. **Session Expiry**: Auto-logout after inactivity
5. **Admin Panel**: Add admin role with special permissions
6. **Profile Management**: Allow users to update their information
7. **Booking History**: Show user's past and current bookings

## Support

Your Oracle database is hosted at:

- **Host**: oracle1.centennialcollege.ca (199.212.26.208)
- **Port**: 1521
- **SID**: SQLD
- **User**: COMP214_F25_zor_26

All user data is securely stored in the `USERS` table with bcrypt-hashed passwords.
